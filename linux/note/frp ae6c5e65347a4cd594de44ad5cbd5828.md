# frp

# 公网IP和内网IP

- 公网IP：内网的设备想要访问非同一个局域网下的资源必须通过公网IP，公网IP是没有经过NAT转换的由ISP提供的最原始的IP地址，每一个公网IP都可以在互联网中被定位到
- 内网IP：内网IP是用户在使用局域网时，由局域网网关分配的IP地址，每一个内网IP实际上都可以映射到当前所在局域网网关的某一个端口，拥有内网IP的设备可以被同一个局域网下的其他设备访问到

当前端使用webpack-dev-server来启动项目时，我们除了通过localhost之外，还可以通过内网IP的方式对我们的项目进行访问，但是我们使用自己的流量是不能访问到的，因为内网IP地址只能在当前局域网下可以被定位到，当我们要跨局域网访问的时候，需要获取到设备的公网IP

![Untitled](frp%20ae6c5e65347a4cd594de44ad5cbd5828/Untitled.png)

# NAT转换技术

由于IPV4地址的数量相对于今天的使用量来说太少，所以就使用网络地址转换技术来对公网IP进行复用，即所有内网主机共享同一个IP地址，NAT转化的方式由三种：

- 静态转换：将内网IP直接转换成公网IP，形成一一对应的关系
- 动态转换：将内网IP转换为公网IP，这个转换会在IP池中选取空闲IP进行转换
- 端口多路复用技术：将内网IP与某一个公网IP绑定，然后通过公网IP某一个端口进行访问

端口多路复用技术可以最大程度缓解IPV4地址紧张的问题，也是目前使用最多的技术，所以对于内网用户来说自己对应的公网IP是不可知的，就好像我们可以知道自己的门牌号，但是不知道我们所在的小区，所以无法准确告诉别人住址

# 内网穿透

frp、ngrok等工具可以在没有服务器的情况将一些服务部署到网络上供其他人使用，这里就是用了内网穿透技术

![Untitled](frp%20ae6c5e65347a4cd594de44ad5cbd5828/Untitled%201.png)

内网穿透的核心原理在于将外网IP地址与内网IP地址建立联系，市面上常用的花生壳工具就是依靠一台具有公网IP的服务器作为请求的中转站来达到穿透的目的

当我们启动工具的时候，工具会将本地配置好的端口和服务器上的端口进行映射，告知服务器请求转发的路径，工具的公网服务器则会监听相应端口的请求，当用户访问工具提供的IP地址时，工具内部就对应的IP地址的公网主机就会根据访问的端口映射到相应的内网主机

# 实现内网穿透

```java
服务端设置(frps.ini)：
[common]
bind_port = 7000       //此处填写客户端监听的服务端端口号
vhost_http_port = 8080 //此处填写用户访问的端口号

客户端配置(frpc.ini)：
[common]
server_addr = x.x.x.x //此处填写服务端 IP 地址
server_port = 7000    //此处填写服务端配置的bind_port

[web]
type = http         //此处规定转发请求的协议类型
local_port = 80     //此处规定本地服务启动的地址
custom_domains = www.example.com   //此处可以填写自定义域名（需要在 IP 地址下配置域名解析）
```

![Untitled](frp%20ae6c5e65347a4cd594de44ad5cbd5828/Untitled%202.png)